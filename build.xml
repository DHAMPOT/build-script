# make clean
rm -rf out/target/product/platina

# Telgram env setup
export BOT_MSG_URL="https://api.telegram.org/bot"$BOT_API"/sendMessage"

tg_post_msg() {
 curl -s -X POST "$BOT_MSG_URL" -d chat_id="-1001521554007" \
 -d "parse_mode=html" \
 -d text="$1"
}

tg_post_msg "STARTING BUILD CygnusOS" "$CHATID"
# build rom
source build/envsetup.sh
lunch cygnus_platina-userdebug
export SKIP_API_CHECK=true
export SKIP_ABI_CHECK=true
export TZ=Asia/Jakarta
export CCACHE_DIR=~/ccachecygnus
export CCACHE_EXEC=$(which ccache)
export USE_CCACHE=1
ccache -M 10G
ccache -z

up(){
	curl --upload-file $1 https://transfer.sh/$(basename $1); echo
}

make cygnus -j$(nproc --all) | tee build-log.txt \
	&& send_zip=$(up out/target/product/platina/*zip) && tg_post_msg "Build Succeed! 
$send_zip" "CHATID" \
	|| send_log=$(up build-log.txt) && tg_post_msg "Build Failed! $send_log" && ccache -s 
ccache -s

