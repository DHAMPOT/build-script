
# Telgram env setup
export BOT_MSG_URL="https://api.telegram.org/bot"$BOT_API"/sendMessage"

tg_post_msg() {
 curl -s -X POST "$BOT_MSG_URL" -d chat_id="-1001521554007" \
 -d "parse_mode=html" \
 -d text="$1"
}

# sync rom
repo init --depth=1 --no-repo-verify -u git://github.com/ForkLineageOS/android.git -b lineage-18.1 -g default,-device,-mips,-darwin,-notdefault
git clone https://github.com/DHAMPOT/dependencies.git --depth 1 -b flos .repo/local_manifests
tg_post_msg "STARTING Fork Lineage  SYNC" "$CHATID"
repo sync -c --no-clone-bundle --no-tags --optimized-fetch --prune --force-sync -j8


tg_post_msg "STARTING BUILD Fork Lineage GAPPS" "$CHATID"
# build rom
source build/envsetup.sh
lunch lineage_platina-userdebug
export TARGET_FLOS=true
export WITH_GAPPS=true
export SKIP_API_CHECK=true
export SKIP_ABI_CHECK=true
export TZ=Asia/Jakarta
export CCACHE_DIR=~/ccacheflos
export CCACHE_EXEC=$(which ccache)
export USE_CCACHE=1
ccache -M 10G
ccache -z

up(){
	curl --upload-file $1 https://transfer.sh/$(basename $1); echo
}

make bacon -j$(nproc --all)

send_zip=$(up out/target/product/platina/*zip) 

tg_post_msg "Build Succeed! $send_zip" "$CHATID"

ccache -s

rm -rf .repo/local_manifests
